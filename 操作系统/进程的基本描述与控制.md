**目录**

2. [进程的描述](# 进程的描述)
3. [进程控制](# 进程控制)
4. [进程同步](# 进程同步)
5. [经典的进程同步问题](# 经典的进程同步问题)
6. [进程通信](# 进程通信)
7. [线程的基本概念](# 线程的基本概念)
8. [线程实现](# 线程实现)

---



#### 进程的描述

---

1. 前驱图

   前驱图是一个有向无环图，两个相邻的节点之间的边描述了两个节点的拓扑关系(偏序关系)。需要注意的是有向无环图是不能够存在有环的。

2. 程序顺序执行的特征

   各个程序块之间，必须按照某种先后次序顺序执行，仅当前一个操作执行完毕后，才能执行后续操作。

   + 程序顺序执行时的特征

     1. 顺序性: 每一个操作必须在上一个操作结束后才能开始。
     2. 封闭性: 程序在封闭的环境下执行，程序运行时独占全机资源。一旦程序执行，执行结构不受影响。
     3. 可以再现性: 只要程序执行时环境和初始条件相同，无论程序如何的重复执行，获得的结果都是相同的。

     顺序执行有利于检测和校验程序。

     <img src="E:\截图文件\程序的顺序执行.png" style="zoom:67%;" />

3. 程序并发执行的特征

   + 间断性

     程序并发执行时，由于共享系统资源，以及为了完成同一项任务相互合作，使得在并发过程中形成了制约关系。因此会导致并发程序的执行--暂停--执行的间断性活动规律。

   + 失去封闭性

     程序并发执行时，多个程序共享系统各种资源，这些资源有多个程序来改变，致使程序的执行会受到其他并发程序的影响，失去了封闭性。

   + 不可再现性

     程序失去了封闭性亦可能导致程序失去了可在现性。即执行环境和初始条件相同，获得的执行结果不同。

     <img src="E:\截图文件\程序并发执行前驱图.png" style="zoom:67%;" />

4. 进程的特征

   + 结构特征

     正常状态下程序是不能够并发执行的，为了使程序能够独立运行，应当为其配置一个**进程控制块**(PCB)。因此创建进行通常指的是对进程控制块的创建，撤销进程实质上是对PCB的撤销(free)。**进程实体**由PCB,程序段，相关数据段组成。

   + 动态性

     进程实质是进程实体的一次执行，因此动态性是进程的基本特征，此外还表现在:进程由创建而生,由调度而执行，由撤销而消亡。

   + 并发性

     指的是多个进程同时存在于内存中，且能一段时间内同时运行。并发性是进程的重要特征。通常程序没有PCB是不能并发执行的。

   + 独立性

     进程实体能够独立运行，独立分配资源，独立接受调度。

   + 异步性

     进程按照各自独立的，不可预知的速度向前前进。

   因此，进程是进程实体的运行过程，是系统分配资源和调度的一个独立单位。

5. 进程的状态

   + 就绪状态

     当进程分配到处CPU之外的所有资源之后，只要再获得CPU即可立即执行，这个状态叫做就绪状态。一个系统中具有多个就绪状态的进程可以有多个，通常会排列成一个队列，叫做就绪队列。

   + 执行状态

     进程以及获得CPU的状态，在多处理机系统中可以有多个进程处于执行状态。

   + 阻塞状态由于发生时间而导致进程暂时无法进行，便放弃处理机而处于暂停状态。造成阻塞的常见事件有: 请求IO，申请缓冲空间。通常这个处于阻塞状态下的进程也会组成队列，有的系统还会根据不同的阻塞原因组成不同的队列。

     ![](E:\截图文件\Snipaste_2020-01-08_15-13-28.png)

   + 挂起状态

     设置挂起状态之后，使得进行处于就绪状态，但是不会再受OS的调度。

     主要应用于:

     1. 终端用户的请求: 用户希望在程序运行期间发现可疑的问题，并对其进行修改

     2. 父进程请求: 父进程希望挂起某个子进程，并对其进行修改。

     3. 符合调节需求: 实时系统中工作负荷较重，为保证系统正常运行，会将一些不重要的进程挂起。

     4. 操作系统要求: OS希望挂起某些进程，检查运行过程中资源使用情况。

        <img src="E:\截图文件\4状态转换图.png" style="zoom:80%;" />

   + 创建状态

     创建进程包括两个部分:

     1. 为了创建一个新的PCB，需要填写必要的管理信息
     2. 将进程转入就绪状态，添加到就绪队列中。

     当一个新的进程被创建时，系统为其分配了PCB，填写了进程标识信息。但是由于进程所需要的其他信息或者资源，比如说主存资源尚未分配。此时进程拥有了自己的PCB，但是并没有进入主存，即进程创建完成，处于**创建状态**。此时进程还是不能被调度执行。

   + 终止状态

     进程终止的步骤

     1. 等待操作系统善后
     2. 对PCB清空，并将PCB空间返回给系统(释放内存空间)

     一旦其他进程完成对终止进程的信息提取之后，操作系统将会对其进行删除操作。

     <img src="E:\截图文件\5状态转换图.png" style="zoom:80%;" />

6. 进程控制块

   + 进程控制块作用

     是操作系统中最重要的记录型数据结构。PCB记录了操作系统中**所需的**，用于**描述进程当前情况**以及控制**进程运行**的全部信息。PCB是进程存在的唯一标志。

     PCB生存在进程的生命周期中，在此期间，可以被操作系统的多个模块读或者修改。如**调度程序**，**资源分配程序**，**中断处理程序**和**监督分析程序**等。由于PCB经常被访问，所有PCB应当常驻内存。系统将所有的PCB组织成一个链表(队列)。

   + 进程控制块基本信息

     1. 进程标识符

        用于唯一的标识进程

        + 内部标识符

          方便系统使用

        + 外部标识符

          在用户访问进程时使用，为了描述进程的**家族关系**，还应当设置父进程以及子进程的标志。还可以设置用户标志，只是拥有进程的用户。

     2. 处理机状态

        处理机状态信息主要有处理机的各种寄存区中内容组成。当处理机被中断时，所有这些信息都必须保存在PCB中，以便重新执行时能够**断点继续执行**。这些信息包括:

        + 通用寄存器

          用于暂存信息，可供用户访问

        + 指令计数器

          存放着需要访问的下一条指令地址

        + 程序状态字

          状态信息: 条件码，执行方式，中断屏蔽方式

        + 用户栈指针

          每个用户都有一个或多个相关的系统栈，用于存放过程和**系统调用参数**以及**调用地址**,栈指针指向栈的栈顶。

     3. 进程调度信息

        存放一些与进程调度有进程替换相关的信息。

        + 进程状态

          指明进程为当前状态，作为**进程调度**和**进程对换**的依据。

        + 进程优先级

          优先级高，则处理机优先处理

        + 进程调度需要的其他信息

          与所采用的的进程调度方法有关。比如，进程等待CPU时间总和，进程已经执行时间总和等。

        + 时间

          主要是阻塞原因

     4. 进程控制信息

        + 程序和数据的地址

          指的是程序和数据所在内存或者是外存的**首地址**，以便到该程序执行时，能够从PCB中找到程序和数据。

        + 进程同步和通信机制

          实现进程同步和进程通信时必须要的机制，如**消息队列指针**，**信号量**等

        + 资源清单

          除CPU外进程所需的全部资源，以及分配到该进程的资源

        + 链接指针

          指向PCB所在队列中，下一个进程PCB的**首地址**

   + 进程控制块的组织方式

     1. 链接方式

        指具有同一状态的PCB连接成一个队列。这样基本可以形成就绪队列，阻塞队列，以及空白队列。其中需要对就绪队列按照优先级关键字排序，以供处理机处理。

        <img src="E:\截图文件\PCB链式存储.png" style="zoom:80%;" />

     2. 索引方式

        系统根据又有进程状态建立几张索引表，例如**就绪索引表**，**阻塞索引表**。索引表中存储PCB内存首地址。

        <img src="E:\截图文件\PCB索引表.png" style="zoom:80%;" />

#### **进程控制**

---

进程控制一般有OS内核中**原语**来实现

原语有若干条指令组成，用于完成一定功能的一个过程，具有**原子操作**的特性。原子操作指的是一个操作中的所有动作要么全做，要么全不做，执行过程中不允许被中断。原则操作在**管态**状态下常驻内存。

原语作用是实现进程的通信和控制，系统对于进程如果不使用原语，就会造成状态的不确定性。

1. **进程的创建**
2. **进程的终止**
3. **进程的阻塞与唤醒**
4. **进程的挂起与激活**

#### **进程同步**

---



#### **经典的进程同步问题**

---



#### **进程通信**

---



#### **线程的基本概念**

---



#### **线程实现**

---


