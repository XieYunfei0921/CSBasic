#### 服务的注册和发现

**服务注册**：

在服务治理的框架中，通常会构建一个注册中心，每个服务单元向注册中心登记自己提供的服务，将主机号，端口号，协议信息等告知给注册中心，注册中心按照名称分类组织服务清单。

即服务注册中心会维护一个内部的数据结构，存储服务名称和服务信息的映射信息。外部调用服务的时候会映射到服务信息中，使用服务信息中的参数进行调用。

**服务发现**：

在服务治理框架下，服务间调用不再通过指定具体的实例地址信息来实现，而是通过指定服务名称来实现。主要是维护了一个底层的映射关系。



#### Eureka的介绍

**Eureka服务端**

服务注册中心,支持高可用配置,依托于强一致性提供良好的服务实例可用性.

Eureka可以将自己作为服务注册到另一个服务注册中心(服务端),形成服务注册中心的高可用.

**Eureka客户端**

主要处理服务与发现,客户端通过注解或者参数配置的方式,嵌入在客户端应用程序的代码中.在应用运行的时候,Eureka客户端向服务注册中心注册自己的服务,并向服务注册中心周期性的发送心跳信息.



#### Eureka的基本架构

服务治理框架常用的有三个部分组成

##### **服务注册中心**

Eureka服务端,提供服务注册和发现功能

**失效剔除**

当长时间客户端无法向服务端发送心跳信息的时候,服务端会从服务列表中将这些信息剔除.



##### **服务提供者**

提供服务的应用,可以是SpringBoot应用,也可以是其他支持Eureka的应用.

**服务注册**

启动的时候会通过发送REST请求,将自己注册到Eureka服务器中,同时带上自身服务的一些元数据信息.Eureka Server接收到这个REST请求之后,将元数据信息存储在一个双层的Map结构中.

其中第一层key为服务名称

第二层key是具体服务的实例名称

**服务同步**

当整个集群中有多个注册中心的时候,当请求一个服务注册中心的时候,它会将请求转发到集群中其他相连的注册中心.从而实现注册中心的同步,同步服务同步,两个服务提供者的服务信息就可以通过这两台服务注册中心的任意一台获取到.

**服务租约**

服务注册完毕之后,服务提供者会向注册中心维护一个心跳,告诉注册中心存活状态.如果长时间没有心跳信息,则会被移出服务列表.



##### **服务消费者**

消费者应用从服务注册中心获取服务列表,从而使得消费者可以知道在什么位置调用服务.可以使用Ribbon或者Feign进行消费.

**获取服务**

当我们启动服务消费者的时候,会发送一个REST请求给服务注册中心,来获取上面注册的服务清单.

**服务调用**

当获取服务清单之后,通过服务名称可以获取具体提供服务的实例名称和实例的元数据信息.有了这些实例的信息,客户端可以自己决定使用哪一个实例.

