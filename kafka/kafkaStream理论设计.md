#### Kafka Stream概念

kafka Stream的优势

+ 简单轻量级的客户端库，可以嵌入到java应用中并与其他存在的包进行整合，部署。
+ 除了Kafka之外，无需依赖其他类型的外部依赖。
+ 支持对本地状态的容错，可以快速高效的开启状态操作。例如窗口join和聚合。
+ 支持仅仅一次消费的语义，保证消息有且会被消费一次
+ 使用实时记录处理，以获取毫秒级的处理延时，支持基于窗口操作的事件时间
+ 支持高级消费者和低级消费者

##### 流式处理拓扑关系

+ 流式处理是kafka stream的基本抽象，代表无界的，连续的更新数据集。一个流式可排序的，可以进行重演的，以及具有容错功能的可变数据记录序列，这个数据记录是kv型数据对。
+ 流式处理应用是一个可以利用kafka stream库的程序。通过处理逻辑拓扑图定义了计算逻辑，这个拓扑图的阶段是流式处理器，而边指定就是连接的流。

- 流式处理器是拓扑图中的一个节点，代表流式数据转换的处理步骤，从上游读取输入记录，使用在处理器上的操作，产生一个或者多个输出记录到下游处理器中

有两种特别的处理其

+ Source处理器： 特殊类型的处理器，没有上游节点，从一个或者多个kafka topic中获取输入记录，并发送数据到下游处理器中
+ Sink处理器：没有下游节点的处理器，发送接收的数据到指定的kafka topic中

注意到正常的处理器节点在处理当前记录的时候是可以被获取的。因此处理结果可以就是传输到Kafka中或者写出到外部系统中。

<img src="E:\截图文件\Kafka流式拓扑图.png" style="zoom:67%;" />

kafka stream提供两种定义拓扑逻辑图的方式。

+ Kafka Stream DSL: 通用转换操作，例如`map`,`filter`,`join`和`aggregation`

低级处理器API允许开发者定义和连接自定义的处理器以及和状态存储器交互.

##### 计时器

流式处理重要的处理就是对计时器的处理,且需要对其进行模型化和整合.例如,窗口操作就是基于计时器的.

流式处理中计时器的语义包括:

+ **事件时间** 

  事件或者数据记录发生的时间点

+ **处理时间**

  事件/记录被流式应用处理的时间点

+ **消化时间**

  事件/数据记录存储到topic的时间.与事件时间不同的是当记录添加到broker的topic时会产生时间戳信息

事件时间和消化时间的选取取决于kafka的配置.在kafka 0.10.x以上版本,时间戳自动添加到kafka消息中.

##### 聚合

##### 窗口

##### 流的持续时间和表

##### 状态

##### 处理保证

###### 乱序处理

#### Kafka Stream架构

##### Stream分区和任务

##### 线程模型

##### 本地状态存储

##### 容错